- ë°©í–¥
    - ë‹¨ë°©í–¥ : í•œ ìª½ë§Œ ì°¸ì¡°
    - ì–‘ë°©í–¥ : ì–‘ìª½ ëª¨ë‘ ì„œë¡œ ì°¸ì¡°
    - ë°©í–¥ì€ ê°ì²´ê´€ê³„ì—ì„œë§Œ ì¡´ì¬
        - í…Œì´ë¸” ê´€ê³„ëŠ” í•­ìƒ ì–‘ë°©í–¥
- ë‹¤ì¤‘ì„±
    - ë‹¤ëŒ€ì¼(N:1)
    - ì¼ëŒ€ë‹¤(1:N)
    - ì¼ëŒ€ì¼(1:1)
    - ë‹¤ëŒ€ë‹¤(N:M)
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
    - ê°ì²´ë¥¼ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ë§Œë“¤ë©´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•´ì•¼ í•¨

## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

- ë‹¤ëŒ€ì¼(N:1)

- ê°ì²´ vs í…Œì´ë¸” ì—°ê´€ê´€ê³„
    - ê°ì²´ëŠ” ì°¸ì¡°(ì£¼ì†Œ)ë¡œ ì—°ê´€ ê´€ê³„
    - í…Œì´ë¸” : ì™¸ë˜ í‚¤ë¡œ ì—°ê´€ ê´€ê³„
- ì°¸ì¡°ë¥¼ í†µí•œ ì—°ê´€ê´€ê³„ëŠ” ì–¸ì œë‚˜ ë‹¨ë°©í–¥
    - ê°ì²´ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì°¸ì¡°í•˜ë ¤ë©´ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ 2ê°œ ë§Œë“¤ì–´ì•¼ í•¨
- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ì–‘ë°©í–¥ ê´€ê³„ (join í™œìš©)

### ì˜ˆì‹œ

- JPA ì—°ê´€ê´€ê³„
    
    ```java
    @Entity
    public class Member {
     @Id
     @Column(name="MEMBER_ID")
     private String id;
     
     private String username;
     
     // ì—°ê´€ê´€ê³„ ë§¤í•‘
     @MantToOne
     @JinColumn(name="TEAM_ID")
     private Team team;
     
     // ì—°ê´€ê´€ê³„ ì„¤ì •
     public void setTeam(Team team) {
    	 this.team = team;
    	}
    	
    	// Getter, Setter...
    }
    ```
    
    ```java
    @Entity
    public class Team {
    
    	@Id
    	@Column(name="TEAM_ID")
    	private String id;
    	
    	private String name;
    	
    	//Getter, Setter ...
    }
    ```
    
    - member.team_id ì™¸ë˜ í‚¤ ì»¬ëŸ¼ ì‚¬ìš©
    - Member.teamê³¼ Member.TEAM_IDë¥¼ ë§¤í•‘
    
- @ManyToOne
    - ë‹¤ëŒ€ì¼ ê´€ê³„ ë§¤í•‘ ì •ë³´
- @JoinColumn
    - ì™¸ë˜í‚¤ë¥¼ ë§¤í•‘í•  ë•Œ ì‚¬ìš©
    - name : ë§¤í•‘í•  ì™¸ë˜ í‚¤ ì´ë¦„
    - referencedColumnName : ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ëŒ€ìƒ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ëª…
    - foreignKey(DDL) : ì™¸ë˜ í‚¤ ì œì•½ì¡°ê±´ì„ ì§ì ‘ ì§€ì • (í…Œì´ë¸” ìƒì„±í•  ë•Œë§Œ ì‚¬ìš©)
    

## ì—°ê´€ê´€ê³„ ì‚¬ìš©

### ì €ì¥

```java
// ì—°ê´€ê´€ê³„ë¥¼ ë§¤í•‘í•œ ì—”í‹°í‹° ì €ì¥
public void testSave() {
	// íŒ€1 ì €ì¥
	Team team1 = new Team("team1", "íŒ€1");
	em.persist(team1);
	
	// íšŒì›1 ì €ì¥
	Member member1 = new Member("member1", "íšŒì›1");
	member.setTeam(team1); //ì—°ê´€ê´€ê³„ ì„¤ì • member1 -> team1
	em.persist(member1);
	
	// íšŒì›2 ì €ì¥
	Member member2 = new Member("member2", "íšŒì›2");
	member2.setTeam(team1);
	em.persist(member2);
}
```

### ì¡°íšŒ

- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰(ê°ì²´ ì—°ê´€ê´€ê³„ë¥¼ ì‚¬ìš©í•œ ì¡°íšŒ)
    - ê°ì²´ë¥¼ í†µí•´ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒ
    
    ```java
    Member member = em.find(Member.class, "member1");
    Team team = member.getTeam();
    System.out.println("íŒ€ ì´ë¦„ = " + team.getName());
    // íŒ€ ì´ë¦„ = íŒ€1
    ```
    
    - member.getTeam()ì„ ì‚¬ìš©í•´ì„œ memberì™€ ì—°ê´€ëœ team ì—”í‹°í‹°ë¥¼ ì¡°íšŒ
- ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì‚¬ìš©
    - JPQL
    
    ```java
    private static void queryLogicJoin(EntityManager em) {
    	String jpq1 = "select m from Member m join m.team t where t.name=:teamName";
    	
    	List<Member> resultList = em.createQuery(jpq1, Member.class)
    			.setParameter("teamName", "íŒ€1") 
    			.getResultList();
    	
    	// íŒ€1ì— ì†Œì†ëœ ëª¨ë“  íšŒì›ì„ ì¡°íšŒ	
    	for (Member member : resultList) {
    		System.out.println("[query] member.username=" + member.getUsername());
    	}
    }
    
    ```
    
    - :teamName ì²˜ëŸ¼ : ë¡œ ì‹œì‘í•˜ëŠ” ê²ƒì´ íŒŒë¼ë¯¸í„°ë¥¼ ë°”ì¸ë”©ë°›ëŠ” ë¬¸ë²•

### ìˆ˜ì • (Update)

```java
private static void updateRelation(EntityManager em) {
	
	// ìƒˆë¡œìš´ íŒ€2
	Team team2 = new Team("team2", "íŒ€2");
	em.persist(team2);
	
	// íšŒì›1ì— ìƒˆë¡œìš´ íŒ€2 ì„¤ì •
	Member member = em.find(Member.class, "member1");
	member.setTeam(team2);
}
```

```java
// ì—°ê´€ê´€ê³„ ì œê±°
private static void deleteRelation(EntityManager em) {
	Member member1 = em.find(Member.class, "member1");
	member.setTeam(null); // ì—°ê´€ê´€ê³„ ì œê±°
}
```

<aside>
ğŸ’¡

ì—°ê´€ëœ ì—”í‹°í‹° ì‚­ì œì‹œ, ê¸°ì¡´ì— ìˆë˜ ì—°ê´€ê´€ê³„ë¥¼ ë¨¼ì € ì œê±°í•˜ê³  ì‚­ì œí•´ì•¼ í•¨!!

member1.setTeam(nul); //íšŒì›1 ì—°ê´€ê´€ê³„ ì œê±°

member2.setTeam(nul); //íšŒì›2 ì—°ê´€ê´€ê³„ ì œê±°

em.remove(team); // íŒ€ ì‚­ì œ ì—°ê´€ê´€ê³„ ì œê±°

</aside>

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

```java
@Entity
public class Member {
 
	 @Id
	 @Column(name = "MEMBER_ID")
	 private String id;
	 
	 private String username;
	 
	 @ManyToone
	 @JoinColumn(name="TEAM_ID")
	 private Team team;
	 
	 // ì—°ê´€ê´€ê³„ ì„¤ì •
	 public void setTeam(Team team) {
		 this.team = team;
	}
	
	// Getter, Setter ...
} 
// ê¸°ì¡´ ì—”í‹°í‹°ì™€ ë™ì¼
```

```java
@Entity
public class Team {
	
	@Id
	@Column(name="TEAM_ID")
	private String id;
	
	private String name;
	
	//==ì¶”ê°€==//
	@OneToMany(mappedBy="team")
	private List<Member> members = new ArrayList<Member>();
	
	// Getter, Setter ...
}
	
```

- ì¼ëŒ€ë‹¤
    - íŒ€ ì—”í‹°í‹°ì— ì»¬ë ‰ì…˜ì¸ List<Member> ì¶”ê°€
    - @OneToMany
- mappedBy
    - ì–‘ë°©í–¥ ë§¤í•‘ì¼ ë•Œ ì‚¬ìš©

## ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

- ì—„ë°€í•˜ê²ŒëŠ” ê°ì²´ì— ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ ì—†ìŒ
- ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ 2ê°œë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ìœ¼ë¡œ ì˜ ë¬¶ì–´ì„œ ì–‘ë°©í–¥ì¸ ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ
- ì—”í‹°í‹°ë¥¼ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ì„¤ì •í•˜ë©´, ê°ì²´ì˜ ì°¸ì¡°ëŠ” ë‘˜ì¸ë° ì™¸ë˜ í‚¤ëŠ” í•˜ë‚˜
    - ë‘ ê°ì²´ì˜ ì—°ê´€ê´€ê³„ ì¤‘ í•˜ë‚˜ë¥¼ ì •í•´ì„œ í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•¨
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê´€ê´€ê³„ì™€ ë§¤í•‘ë˜ê³  ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ
    - ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥
- mappedBy
    - ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•˜ëŠ” ì†ì„±
    - ì£¼ì¸ì€ mappedByë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
    - ì£¼ì¸ì´ ì•„ë‹ˆë©´ mappedByë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì§€ì •
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ = ì™¸ë˜ í‚¤ ê´€ë¦¬ì ì„ íƒ
    - â˜…í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ìœ¼ë¡œ ì„¤ì •

- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì—ë„ ê°’ì„ ì…ë ¥í•´ì•¼ í•¨ì— ì£¼ì˜
- ê°ì²´ì˜ ê´€ì ì—ì„œ, ì£¼ì¸ê³¼ ì£¼ì¸ì´ ì•„ë‹Œ ê³³ ëª¨ë‘ì— ê°’ì„ ì…ë ¥í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì „

```java
public void testORM_ì–‘ë°©í–¥() {
	
	// íŒ€ 1 ì €ì¥
	Team team1 = new Team("team1", "íŒ€1");
	em.persist(team1);
	
	Member member1 = new Member("member1", "íšŒì›1");
	
	// ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ì„¤ì •
	member1.setTeam(team1); // ì—°ê´€ê´€ê³„ ì„¤ì • member1 -> team1
	team1.getMembers().add(member1); // ì—°ê´€ê´€ê³„ ì„¤ì • team1 -> member1
	em.persist(member1);
	
	Member member2 = new Member("member2", "íšŒì›2");
	
	// ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ì„¤ì •
	member2.setTeam(team1); // ì—°ê´€ê´€ê³„ ì„¤ì • member2->team1
	team1.getMembers().add(member2); // ì—°ê´€ê´€ê³„ ì„¤ì • team1->member2
	em.persist(member2);
}
```

- Member.team : ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸. ì´ ê°’ìœ¼ë¡œ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬
- Team.members : ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹˜. ì €ì¥ ì‹œ ì‚¬ìš© X
- ì‹¤ì œë¡œëŠ” team1.getMembers().add(member1); ì…ë ¥í•˜ëŠ” ê²ƒë³´ë‹¤, class Memberì˜ setTeamì— í•´ë‹¹ ë‚´ìš©ì„ ë„£ì–´ì£¼ëŠ” ê²Œ ì•ˆì „ (ì‹¤ìˆ˜ë¥¼ ì¤„ì„)
    
    ```java
    public class Member {
    	
    	private Team team;
    	
    	public void setTeam(Team team) {
    	
    		// ê¸°ì¡´ íŒ€ê³¼ ê´€ê³„ë¥¼ ì œê±° 
    		if(this.team!=null) {
    			this.team.getMembers().remove(this);
    		}
    	
    		this.team = team;
    		team.getMembers().add(this);
    	}
    }
    ```
